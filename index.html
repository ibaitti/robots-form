<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AI Digital Employee Diagnostic</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Space+Grotesk:wght@500;600&display=swap"
    rel="stylesheet"
  />

  <!-- Tailwind CDN (v3) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: [
              'Inter',
              '-apple-system',
              'system-ui',
              'BlinkMacSystemFont',
              'SF Pro Text',
              'Segoe UI',
              'sans-serif',
            ],
            display: ['Space Grotesk', 'system-ui', 'sans-serif'],
          },
          colors: {
            brand: {
              navy: '#0F172A',
              muted: '#6B7280',
              border: '#E5E7EB',
              input: '#F9FAFB',
              primary: '#2563EB',
              cyan: '#22D3EE',
              gold: '#FACC15',
              success: '#16A34A',
              error: '#DC2626',
            },
          },
          boxShadow: {
            cyanGlow: '0 0 40px rgba(34,211,238,0.25)',
          },
        },
      },
    };
  </script>

  <!-- React + ReactDOM (UMD) -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

  <!-- Framer Motion UMD -->
  <script src="https://unpkg.com/framer-motion@7.6.19/dist/framer-motion.umd.js"></script>

  <!-- Babel Standalone -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    :root {
      color-scheme: light;
    }

    body {
      min-height: 100vh;
      margin: 0;
      font-family: 'Inter', -apple-system, system-ui, 'SF Pro Text', 'Segoe UI', sans-serif;
      background: linear-gradient(to bottom, #F5F7FF, #E0ECFF);
      color: #0F172A;
      -webkit-font-smoothing: antialiased;
    }

    #root {
      min-height: 100vh;
    }

    .glass-card {
      border-radius: 1.5rem;
      border: 1px solid rgba(255, 255, 255, 0.4);
      background: rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(18px);
      box-shadow: 0 0 40px rgba(34, 211, 238, 0.25);
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <!-- App code -->
  <script type="text/babel" data-presets="env,react">
    const { useState, useMemo } = React;

    // Framer Motion UMD global fallback
    const fmGlobal = window.Motion || window.FramerMotion || window['framer-motion'] || {};
    const { motion, AnimatePresence } = fmGlobal;

    const TOTAL_STEPS = 6;

    const STEP_TITLES = {
      1: 'Workflows',
      2: '90-Day Future State',
      3: 'Offer & ICP',
      4: 'Role',
      5: 'Company Size',
      6: 'Urgency & Contact',
    };

    const initialFormData = {
      workflows: '',
      hoursPerWeek: '',
      hourlyRate: '',
      futureState: '',
      offerAndICP: '',
      role: '',
      companySize: '',
      urgency: '',
      email: '',
    };

    // --- ROI engine ---
    function computeRoi(data) {
      const weeksPerMonth = 4.3;
      const automationPercentage = 0.7;

      const rawHoursPerWeek = parseFloat(data.hoursPerWeek);
      const hoursPerWeek =
        Number.isFinite(rawHoursPerWeek) && rawHoursPerWeek > 0 ? rawHoursPerWeek : 0;

      const fallbackHourlyRate = 40;
      const rawHourlyRate = parseFloat(data.hourlyRate);
      const hourlyRate =
        Number.isFinite(rawHourlyRate) && rawHourlyRate > 0 ? rawHourlyRate : fallbackHourlyRate;

      const estimatedHoursPerMonth = hoursPerWeek * weeksPerMonth;
      const estimatedSavingsHoursPerMonth = estimatedHoursPerMonth * automationPercentage;
      const estimatedCostPerMonth = estimatedHoursPerMonth * hourlyRate;
      const estimatedSavingsPerMonth = estimatedSavingsHoursPerMonth * hourlyRate;

      return {
        estimatedHoursPerMonth,
        estimatedSavingsHoursPerMonth,
        estimatedCostPerMonth,
        estimatedSavingsPerMonth,
        assumptions: {
          hourlyRate,
          automationPercentage,
          weeksPerMonth,
        },
      };
    }

    function collectMeta() {
      if (typeof window === 'undefined') return {};
      const url = window.location.href;
      const params = new URLSearchParams(window.location.search);
      const utm = {};
      params.forEach((value, key) => {
        if (key.toLowerCase().startsWith('utm_')) {
          utm[key] = value;
        }
      });
      return {
        url,
        utm: Object.keys(utm).length ? utm : undefined,
        userAgent: navigator.userAgent,
      };
    }

    function validateStep(step, data) {
      const errors = {};

      if (step === 1) {
        if (!data.workflows.trim()) {
          errors.workflows = 'Describe at least one workflow you would hand off.';
        }
      }

      if (step === 2) {
        if (!data.futureState.trim()) {
          errors.futureState = 'Describe your desired 90-day outcome in 1–2 sentences.';
        }
      }

      if (step === 3) {
        if (!data.offerAndICP.trim()) {
          errors.offerAndICP = 'Describe what you sell and who you sell it to.';
        }
      }

      if (step === 4) {
        if (!data.role) {
          errors.role = 'Select the option that best matches your role.';
        }
      }

      if (step === 5) {
        if (!data.companySize) {
          errors.companySize = 'Select your current company size.';
        }
      }

      if (step === 6) {
        if (!data.urgency) {
          errors.urgency = 'Select how serious you are about fixing this.';
        }
        if (!data.email.trim()) {
          errors.email = 'Enter the email where we should send your blueprint.';
        } else {
          const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
          if (!emailRegex.test(data.email.trim())) {
            errors.email = 'Enter a valid business email address.';
          }
        }
      }

      return errors;
    }

    /* ---------------- Layout & shell ---------------- */

    function MainLayout({ children }) {
      return (
        <div className="relative min-h-screen flex items-center justify-center px-4 py-10">
          <div className="absolute inset-0 bg-gradient-to-b from-[#F5F7FF] to-[#E0ECFF]" />
          {children}
        </div>
      );
    }

    function GlassCard({ children }) {
      return (
        <div className="relative glass-card max-w-2xl w-full px-6 py-6 md:px-8 md:py-8">
          {/* Cyan accent line at top */}
          <div className="absolute left-8 right-8 top-0 h-px bg-gradient-to-r from-brand-cyan/70 via-white to-brand-cyan/70" />
          {children}
        </div>
      );
    }

    function Starfield() {
      const stars = [
        { top: '8%', left: '12%', size: 2, opacity: 0.35 },
        { top: '14%', left: '48%', size: 1, opacity: 0.25 },
        { top: '22%', left: '70%', size: 2, opacity: 0.32 },
        { top: '30%', left: '25%', size: 1, opacity: 0.28 },
        { top: '18%', left: '85%', size: 1, opacity: 0.28 },
        { top: '5%', left: '60%', size: 1, opacity: 0.3 },
      ];

      // If Motion isn't available for some reason, render static stars
      if (!motion) {
        return (
          <div className="pointer-events-none absolute inset-x-0 top-0 h-[40vh] overflow-hidden">
            <div className="relative w-full h-full">
              {stars.map((star, idx) => (
                <div
                  key={idx}
                  className="absolute rounded-full"
                  style={{
                    top: star.top,
                    left: star.left,
                    width: star.size,
                    height: star.size,
                    background:
                      idx % 2 === 0
                        ? 'rgba(255,255,255,0.35)'
                        : 'rgba(210,230,255,0.25)',
                    opacity: star.opacity,
                  }}
                />
              ))}
            </div>
          </div>
        );
      }

      return (
        <div className="pointer-events-none absolute inset-x-0 top-0 h-[40vh] overflow-hidden">
          <motion.div
            className="relative w-full h-full"
            animate={{ x: [0, 10, 0], y: [0, 6, 0] }}
            transition={{ duration: 28, repeat: Infinity, ease: 'linear' }}
          >
            {stars.map((star, idx) => (
              <div
                key={idx}
                className="absolute rounded-full"
                style={{
                  top: star.top,
                  left: star.left,
                  width: star.size,
                  height: star.size,
                  background:
                    idx % 2 === 0
                      ? 'rgba(255,255,255,0.35)'
                      : 'rgba(210,230,255,0.25)',
                    opacity: star.opacity,
                  }}
                />
              ))}
            ))}
          </motion.div>
        </div>
      );
    }

    /* ---------------- Reusable controls ---------------- */

    function PrimaryButton({ children, disabled, onClick, href, target, rel }) {
      const className =
        'inline-flex items-center justify-center rounded-full bg-[#2563EB] text-white ' +
        'border border-[#22D3EE]/70 px-5 py-2.5 text-sm font-medium ' +
        'shadow-[0_0_20px_rgba(34,211,238,0.35)] hover:brightness-110 ' +
        'transition-all duration-150 active:scale-95 disabled:opacity-60 ' +
        'disabled:shadow-none disabled:cursor-not-allowed';

      if (href) {
        return (
          <a href={href} target={target} rel={rel} aria-disabled={disabled} className={className}>
            {children}
          </a>
        );
      }

      return (
        <button type="button" className={className} onClick={onClick} disabled={disabled}>
          {children}
        </button>
      );
    }

    function SecondaryButton({ children, disabled, onClick }) {
      return (
        <button
          type="button"
          className="inline-flex items-center justify-center rounded-full border border-brand-border px-4 py-2 text-xs md:text-sm font-medium text-brand-muted hover:bg-white/50 hover:text-brand-navy transition disabled:opacity-50 disabled:cursor-not-allowed"
          onClick={onClick}
          disabled={disabled}
        >
          {children}
        </button>
      );
    }

    function TextAreaField({
      label,
      value,
      onChange,
      helperText,
      error,
      autoFocus,
      rows = 4,
      goldAccent,
    }) {
      return (
        <div
          className={
            'rounded-2xl border ' +
            (goldAccent ? 'border-brand-gold/70' : 'border-transparent') +
            ' bg-white/60 p-3 md:p-4 shadow-sm transition shadow-none focus-within:shadow-cyanGlow focus-within:border-brand-cyan'
          }
        >
          <label className="block text-sm font-medium text-brand-navy mb-1.5">
            {label}
          </label>
          <textarea
            value={value}
            onChange={(e) => onChange(e.target.value)}
            rows={rows}
            autoFocus={autoFocus}
            className="w-full resize-none rounded-xl border border-brand-border bg-brand-input px-3 py-2.5 text-sm text-brand-navy placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-brand-cyan/80 focus:border-transparent"
          />
          {helperText && !error && (
            <p className="mt-1 text-xs text-brand-muted">{helperText}</p>
          )}
          {error && <p className="mt-1 text-xs text-brand-error">{error}</p>}
        </div>
      );
    }

    function NumberField({
      label,
      value,
      onChange,
      suffix,
      helperText,
      error,
    }) {
      return (
        <div className="space-y-1.5">
          <label className="block text-xs font-medium text-brand-navy">{label}</label>
          <div className="flex items-center gap-2 rounded-xl border border-brand-border bg-brand-input px-3 py-2 focus-within:ring-2 focus-within:ring-brand-cyan/80 focus-within:border-transparent">
            <input
              type="number"
              min="0"
              step="0.1"
              value={value}
              onChange={(e) => onChange(e.target.value)}
              className="w-full bg-transparent text-sm text-brand-navy placeholder:text-gray-400 focus:outline-none"
            />
            {suffix && (
              <span className="text-xs text-brand-muted whitespace-nowrap">{suffix}</span>
            )}
          </div>
          {helperText && !error && (
            <p className="text-[11px] text-brand-muted">{helperText}</p>
          )}
          {error && <p className="text-[11px] text-brand-error">{error}</p>}
        </div>
      );
    }

    function SegmentedControl({ label, options, value, onChange, error }) {
      return (
        <fieldset className="space-y-2">
          <legend className="text-sm font-medium text-brand-navy">{label}</legend>
          <div className="flex flex-wrap gap-2">
            {options.map((opt) => {
              const selected = value === opt.value;
              return (
                <button
                  key={opt.value}
                  type="button"
                  onClick={() => onChange(opt.value)}
                  className={
                    'px-4 py-2 rounded-full text-xs md:text-sm border transition ' +
                    (selected
                      ? 'bg-brand-primary text-white border-brand-primary shadow-[0_0_20px_rgba(37,99,235,0.4)]'
                      : 'bg-brand-input text-brand-navy border-brand-border hover:border-brand-primary/60')
                  }
                >
                  {opt.label}
                </button>
              );
            })}
          </div>
          {error && <p className="text-xs text-brand-error">{error}</p>}
        </fieldset>
      );
    }

    function RoiPreview({ roi, compact }) {
      const hours = Math.round(roi.estimatedHoursPerMonth);
      const savingsHours = Math.round(roi.estimatedSavingsHoursPerMonth);
      const savingsValue = Math.round(roi.estimatedSavingsPerMonth);
      const hourlyRate = Math.round(roi.assumptions.hourlyRate);

      if (!hours || !savingsValue) {
        return (
          <div className="mt-4 rounded-2xl border border-dashed border-brand-border bg-white/50 px-4 py-3 text-xs text-brand-muted">
            Add rough estimates for hours per week and hourly cost to see your manual work burn and
            savings preview.
          </div>
        );
      }

      return (
        <div
          className={
            'mt-4 rounded-2xl border border-brand-border bg-white/70 px-4 py-3 ' +
            (compact ? '' : 'md:px-5 md:py-4')
          }
        >
          <p className="text-xs font-medium text-brand-navy mb-2">
            Manual work burn &amp; automation preview
          </p>
          <ul className="space-y-1.5 text-[11px] md:text-xs text-brand-muted">
            <li>
              <span className="font-medium text-brand-navy">
                Manual work burn:&nbsp;
              </span>
              ~{hours} hours/month on the workflows you described.
            </li>
            <li>
              <span className="font-medium text-brand-navy">
                If we automate ~70%:
              </span>{' '}
              that&apos;s roughly {savingsHours} hours/month back to your team.
            </li>
            <li>
              <span className="font-medium text-brand-navy">
                At ~${hourlyRate}/hour fully-loaded:
              </span>{' '}
              that&apos;s ≈ ${savingsValue.toLocaleString()} of capacity freed per month.
            </li>
            <li className="text-[10px] text-brand-muted mt-1.5">
              Directional only. Final numbers depend on exact workflows, routing logic, and model
              configuration.
            </li>
          </ul>
        </div>
      );
    }

    /* ---------------- Step components ---------------- */

    function Step1Workflows({ data, errors, onFieldChange }) {
      return (
        <div className="space-y-5">
          <h1 className="font-display text-2xl md:text-3xl font-semibold text-brand-navy">
            If you had a digital employee that could handle 3–5 repetitive workflows in the next 30
            days, which ones would you pick first?
          </h1>
          <TextAreaField
            label="Describe the repetitive workflows you would hand off first"
            value={data.workflows}
            onChange={(v) => onFieldChange('workflows', v)}
            helperText="Examples: inbox triage, lead qualification, repetitive reporting, updating CRM stages, chasing overdue invoices, compiling weekly performance summaries."
            error={errors.workflows}
            autoFocus={true}
            rows={4}
          />
          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
            <NumberField
              label="Approximate hours per week spent on these workflows"
              value={data.hoursPerWeek}
              onChange={(v) => onFieldChange('hoursPerWeek', v)}
              suffix="hours / week"
              helperText="Rough estimate is enough. If multiple people are involved, sum their hours."
            />
            <NumberField
              label="Average fully-loaded hourly cost of people doing this work"
              value={data.hourlyRate}
              onChange={(v) => onFieldChange('hourlyRate', v)}
              suffix="USD / hour"
              helperText="Include taxes/benefits if possible. If unsure, estimate $30–$80/h depending on seniority."
            />
          </div>
        </div>
      );
    }

    function Step2FutureState({ data, errors, onFieldChange }) {
      return (
        <div className="space-y-4 border-t border-brand-gold/70 pt-4">
          <h1 className="font-display text-2xl md:text-3xl font-semibold text-brand-navy flex items-center gap-2">
            90 days from now, if this works exactly as you want—what’s the one thing you’d love to
            be true about your business?
            <span className="inline-flex h-5 w-5 items-center justify-center rounded-full bg-brand-gold/40 text-[10px] font-semibold text-brand-navy">
              90
            </span>
          </h1>
          <TextAreaField
            label="Describe your ideal 90-day outcome in 1–2 sentences"
            value={data.futureState}
            onChange={(v) => onFieldChange('futureState', v)}
            helperText="Examples: response times under 5 minutes, more qualified leads to sales, more booked calls without extra headcount, 20–40 hours per week freed up, more consistent monthly revenue."
            error={errors.futureState}
            rows={3}
            goldAccent={true}
          />
        </div>
      );
    }

    function Step3OfferICP({ data, errors, onFieldChange }) {
      return (
        <div className="space-y-4">
          <h1 className="font-display text-2xl md:text-3xl font-semibold text-brand-navy">
            What does your company sell, and who is your ideal customer?
          </h1>
          <TextAreaField
            label="Offer & ideal customer"
            value={data.offerAndICP}
            onChange={(v) => onFieldChange('offerAndICP', v)}
            helperText="Example: 'We sell a B2B SaaS for revenue teams, typically working with tech-enabled B2B companies doing $1–10M ARR with 5–30 sales reps.'"
            error={errors.offerAndICP}
            rows={3}
          />
        </div>
      );
    }

    function Step4Role({ data, errors, onFieldChange }) {
      const options = [
        { label: 'Founder / Owner', value: 'Founder / Owner' },
        { label: 'C-Level / VP', value: 'C-Level / VP' },
        { label: 'Operations / Systems', value: 'Operations / Systems' },
        { label: 'Marketing / Sales', value: 'Marketing / Sales' },
        { label: 'Other', value: 'Other' },
      ];

      return (
        <div className="space-y-4">
          <h1 className="font-display text-2xl md:text-3xl font-semibold text-brand-navy">
            Which best describes your role?
          </h1>
          <SegmentedControl
            label="Select your role"
            options={options}
            value={data.role}
            onChange={(v) => onFieldChange('role', v)}
            error={errors.role}
          />
        </div>
      );
    }

    function Step5CompanySize({ data, errors, onFieldChange }) {
      const options = [
        { label: '1–5', value: '1–5' },
        { label: '6–20', value: '6–20' },
        { label: '21–50', value: '21–50' },
        { label: '51–200', value: '51–200' },
        { label: '200+', value: '200+' },
      ];

      return (
        <div className="space-y-4">
          <h1 className="font-display text-2xl md:text-3xl font-semibold text-brand-navy">
            How many employees are in your company?
          </h1>
          <SegmentedControl
            label="Current team size"
            options={options}
            value={data.companySize}
            onChange={(v) => onFieldChange('companySize', v)}
            error={errors.companySize}
          />
        </div>
      );
    }

    function Step6UrgencyEmail({ data, errors, onFieldChange, roi }) {
      const options = [
        {
          label: 'Just exploring / Not urgent',
          value: 'Just exploring / Not urgent',
        },
        {
          label: 'Interested, timing flexible',
          value: 'Interested, but timing is flexible',
        },
        {
          label: 'Priority in next 60 days',
          value: 'This is a priority to solve in the next 60 days',
        },
      ];

      return (
        <div className="space-y-5">
          <h1 className="font-display text-2xl md:text-3xl font-semibold text-brand-navy">
            How serious are you about fixing this in the next 60 days?
          </h1>
          <SegmentedControl
            label="Urgency"
            options={options}
            value={data.urgency}
            onChange={(v) => onFieldChange('urgency', v)}
            error={errors.urgency}
          />

          <div className="grid grid-cols-1 md:grid-cols-2 gap-4 items-start">
            <div className="space-y-3">
              <label className="block text-sm font-medium text-brand-navy">
                Where should we send your AI Digital Employee Blueprint?
              </label>
              <div className="rounded-xl border border-brand-border bg-brand-input px-3 py-2 focus-within:ring-2 focus-within:ring-brand-cyan/80 focus-within:border-transparent">
                <input
                  type="email"
                  value={data.email}
                  onChange={(e) => onFieldChange('email', e.target.value)}
                  className="w-full bg-transparent text-sm text-brand-navy placeholder:text-gray-400 focus:outline-none"
                  placeholder="you@company.com"
                />
              </div>
              {errors.email && (
                <p className="text-xs text-brand-error">{errors.email}</p>
              )}
              {!errors.email && (
                <p className="text-xs text-brand-muted">
                  We&apos;ll use this only to send your blueprint and follow-up context on the
                  diagnostic—no spam sequence.
                </p>
              )}
            </div>

            <RoiPreview roi={roi} />
          </div>
        </div>
      );
    }

    /* ---------------- Root App ---------------- */

    function App() {
      const [step, setStep] = useState(1);
      const [formData, setFormData] = useState(initialFormData);
      const [errors, setErrors] = useState({});
      const [isSubmitting, setIsSubmitting] = useState(false);
      const [isSubmitted, setIsSubmitted] = useState(false);
      const [submitError, setSubmitError] = useState(null);
      const [meta] = useState(() => collectMeta());

      const roi = useMemo(
        () => computeRoi(formData),
        [formData.hoursPerWeek, formData.hourlyRate]
      );

      function handleFieldChange(field, value) {
        setFormData((prev) => ({ ...prev, [field]: value }));
        setErrors((prev) => ({ ...prev, [field]: undefined }));
      }

      function runValidationForStep(currentStep) {
        const stepErrors = validateStep(currentStep, formData);
        if (Object.keys(stepErrors).length > 0) {
          setErrors((prev) => ({ ...prev, ...stepErrors }));
          return false;
        }
        setErrors((prev) => {
          const copy = { ...prev };
          Object.keys(stepErrors).forEach((key) => {
            delete copy[key];
          });
          return copy;
        });
        return true;
      }

      function handleNext() {
        if (!runValidationForStep(step)) return;
        if (step < TOTAL_STEPS) {
          setStep((s) => s + 1);
        }
      }

      function handleBack() {
        if (step > 1 && !isSubmitting) {
          setStep((s) => s - 1);
          setSubmitError(null);
        }
      }

      async function handleSubmit() {
        if (!runValidationForStep(6)) return;

        setIsSubmitting(true);
        setSubmitError(null);

        try {
          const response = await fetch('/api/diagnostic', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              answers: {
                workflows: formData.workflows,
                futureState: formData.futureState,
                offerAndICP: formData.offerAndICP,
                role: formData.role,
                companySize: formData.companySize,
                urgency: formData.urgency,
                email: formData.email,
              },
              roi,
              meta,
            }),
          });

          if (!response.ok) {
            let message = 'Submission failed.';
            try {
              const json = await response.json();
              if (json && json.message) message = json.message;
            } catch (e) {
              // ignore JSON error
            }
            throw new Error(message);
          }

          setIsSubmitted(true);
        } catch (err) {
          const message =
            err instanceof Error
              ? err.message
              : 'Unexpected error while submitting diagnostic.';
          setSubmitError(message);
        } finally {
          setIsSubmitting(false);
        }
      }

      if (isSubmitted) {
        return (
          <MainLayout>
            <Starfield />
            <GlassCard>
              <div className="flex flex-col gap-4">
                <div className="h-px w-20 bg-gradient-to-r from-brand-cyan via-white to-brand-cyan" />
                <h1 className="font-display text-3xl md:text-4xl font-semibold text-brand-navy">
                  Thanks—got it.
                </h1>
                <p className="text-sm md:text-base text-brand-muted">
                  Based on your answers, the next step is a 30-minute call to map a specific AI
                  digital employee to the workflows you selected and validate the assumptions behind
                  the ROI model.
                </p>

                <RoiPreview roi={roi} compact={true} />

                <div className="mt-4 flex flex-col gap-3">
                  <PrimaryButton
                    href="[CALENDAR_LINK_PLACEHOLDER]"
                    target="_blank"
                    rel="noreferrer"
                  >
                    Book your time
                  </PrimaryButton>
                  <p className="text-xs md:text-sm text-brand-muted">
                    You&apos;ll also receive a personalized{' '}
                    <span className="font-medium">AI Digital Employee Blueprint</span> at{' '}
                    <span className="font-mono text-brand-navy">{formData.email}</span> with a
                    breakdown of workflows, automation opportunities, and ROI assumptions.
                  </p>
                </div>
              </div>
            </GlassCard>
          </MainLayout>
        );
      }

      const currentTitle = STEP_TITLES[step];

      // If AnimatePresence isn't available, just render without animations
      const Wrapper = AnimatePresence || React.Fragment;
      const MotionDiv = motion?.div || 'div';

      return (
        <MainLayout>
          <Starfield />
          <GlassCard>
            {/* Progress + step meta */}
            <div className="mb-6 space-y-3">
              <div className="flex items-center justify-between text-xs text-brand-muted">
                <span>{`Step ${step} of ${TOTAL_STEPS}`}</span>
                <span className="font-medium text-brand-navy">{currentTitle}</span>
              </div>
              <div className="h-1.5 w-full rounded-full bg-brand-border overflow-hidden">
                <div
                  className="h-full rounded-full bg-gradient-to-r from-brand-primary to-brand-cyan"
                  style={{ width: `${(step / TOTAL_STEPS) * 100}%` }}
                />
              </div>
            </div>

            <Wrapper mode={AnimatePresence ? 'wait' : undefined}>
              <MotionDiv
                key={step}
                initial={AnimatePresence ? { opacity: 0, x: 16 } : undefined}
                animate={AnimatePresence ? { opacity: 1, x: 0 } : undefined}
                exit={AnimatePresence ? { opacity: 0, x: -16 } : undefined}
                transition={AnimatePresence ? { duration: 0.22 } : undefined}
                className="space-y-6"
              >
                {step === 1 && (
                  <Step1Workflows
                    data={formData}
                    errors={errors}
                    onFieldChange={handleFieldChange}
                  />
                )}
                {step === 2 && (
                  <Step2FutureState
                    data={formData}
                    errors={errors}
                    onFieldChange={handleFieldChange}
                  />
                )}
                {step === 3 && (
                  <Step3OfferICP
                    data={formData}
                    errors={errors}
                    onFieldChange={handleFieldChange}
                  />
                )}
                {step === 4 && (
                  <Step4Role
                    data={formData}
                    errors={errors}
                    onFieldChange={handleFieldChange}
                  />
                )}
                {step === 5 && (
                  <Step5CompanySize
                    data={formData}
                    errors={errors}
                    onFieldChange={handleFieldChange}
                  />
                )}
                {step === 6 && (
                  <Step6UrgencyEmail
                    data={formData}
                    errors={errors}
                    onFieldChange={handleFieldChange}
                    roi={roi}
                  />
                )}
              </MotionDiv>
            </Wrapper>

            {/* Footer controls */}
            <div className="mt-8 flex flex-col gap-3 md:flex-row md:items-center md:justify-between">
              <SecondaryButton onClick={handleBack} disabled={step === 1 || isSubmitting}>
                Back
              </SecondaryButton>

              <div className="flex flex-col items-end gap-2 sm:flex-row sm:items-center sm:gap-3">
                {submitError && (
                  <p className="text-xs text-brand-error max-w-xs text-right">{submitError}</p>
                )}
                <PrimaryButton
                  onClick={step === TOTAL_STEPS ? handleSubmit : handleNext}
                  disabled={isSubmitting}
                >
                  {step === TOTAL_STEPS
                    ? isSubmitting
                      ? 'Submitting…'
                      : 'Submit diagnostic'
                    : 'Next'}
                </PrimaryButton>
              </div>
            </div>

            {isSubmitting && (
              <div className="mt-4 flex items-center gap-2 text-xs text-brand-muted">
                <div className="h-4 w-4 rounded-full border-2 border-brand-primary border-t-transparent animate-spin" />
                <span>Submitting your diagnostic…</span>
              </div>
            )}
          </GlassCard>
        </MainLayout>
      );
    }

    const rootElement = document.getElementById('root');
    const root = ReactDOM.createRoot(rootElement);
    root.render(<App />);
  </script>
</body>
</html>
